# =============================================================================
# METHODOLOGY: Self-Contained Context Unit
# =============================================================================
# Generated by ref101-meta extract on 2026-01-16
#
# This file describes the sccu methodology using the
# 8 elements of meta-methodology v3.1:
#   State, Actor, Tool, Action, Entity, Artifact, Fact, Rule
#
# For documentation, see: meta/README.md
# =============================================================================

methodology_id: "sccu"
version: "2.0.0"
name: "Self-Contained Context Unit"
meta_version: "3.1"
description: "Methodology extracted from sccu namespace"

# === ENTITIES (Business objects passing through States) ===
entities:
  - id: "release"
    type: "Release"
    role: "primary"
    schema:
      version: "string (required)"
      feature_name: "string (required)"
      problem_statement: "string (required)"
      current_phase: "string"
    artifacts:
      - "release_artifact"
      - "pc_artifact"
      - "ic_artifact"
      - "qa_artifact"
      - "bc_delta_artifact"
      - "ac_delta_artifact"
      - "plan_finalize_artifact"

# === STATES (Lifecycle phases) ===
states:
  - id: "RELEASE"
    name: "RELEASE"
    type: "Initial"
    allowed_actions:
      - "create_release"
  - id: "PC"
    name: "PC"
    type: "Working"
    allowed_actions:
      - "create_pc"
      - "handle_error"
  - id: "IC"
    name: "IC"
    type: "Working"
    allowed_actions:
      - "create_ic"
      - "handle_error"
  - id: "QA"
    name: "QA"
    type: "Waiting"
    allowed_actions:
      - "create_qa"
      - "approve_qa"
      - "handle_error"
    timeout: "24h"
  - id: "DEPLOY"
    name: "DEPLOY"
    type: "Terminal"
    allowed_actions:
      - "create_deploy"
  - id: "BC_DELTA"
    name: "BC Delta"
    type: "Waiting"
    allowed_actions:
      - "create_bc_delta"
      - "approve_bc_delta"
      - "handle_error"
    timeout: "24h"
  - id: "AC_DELTA"
    name: "AC Delta"
    type: "Waiting"
    allowed_actions:
      - "create_ac_delta"
      - "approve_ac_delta"
      - "handle_error"
    timeout: "24h"
  - id: "PLAN_FINALIZE"
    name: "Plan Finalize"
    type: "Waiting"
    allowed_actions:
      - "create_plan_finalize"
      - "approve_plan_finalize"
      - "handle_error"
    timeout: "24h"
  - id: "APPLY_DELTAS"
    name: "Apply Deltas"
    type: "Working"
    allowed_actions:
      - "create_apply_deltas"
      - "handle_error"
  - id: "ERROR"
    name: "Error"
    type: "Error"
    allowed_actions:
      - "handle_error"
      - "retry_phase"
    on_timeout:
      action: "escalate"
      target_state: "DEPLOY"

# === ACTORS (Executors: Human, AI, System) ===
actors:
  - id: "claude_agent"
    name: "Claude Code Agent"
    type: "AI"
    tools:
      - "mcp_pcc"
      - "edit"
      - "bash"
    permissions:
      - "create_artifact"
      - "transition_phase"
      - "read_code"
      - "write_code"
  - id: "qa_lead"
    name: "QA Lead"
    type: "Human"
    tools:
      - "approval_ui"
    permissions:
      - "approve_qa_lead"
  - id: "product_owner"
    name: "Product Owner"
    type: "Human"
    tools:
      - "approval_ui"
    permissions:
      - "approve_product_owner"
  - id: "tech_lead"
    name: "Technical Lead"
    type: "Human"
    tools:
      - "approval_ui"
    permissions:
      - "approve_tech_lead"
  - id: "team"
    name: "Development Team"
    type: "Human"
    tools:
      - "approval_ui"
    permissions:
      - "approve_team"

# === TOOLS (Instruments for Actions) ===
tools:
  - id: "mcp_pcc"
    name: "PCC MCP Server"
    type: "MCP"
    compatible_actors:
      - "AI"
    operations:
      - "pcc_init_release"
      - "pcc_create_artifact"
      - "pcc_workflow_transition"
      - "pcc_workflow_status"
  - id: "edit"
    name: "File Editor"
    type: "Script"
    compatible_actors:
      - "AI"
    operations:
      - "read"
      - "write"
      - "edit"
  - id: "bash"
    name: "Bash Shell"
    type: "Script"
    compatible_actors:
      - "AI"
      - "System"
    operations:
      - "execute_command"
      - "git_operations"
  - id: "approval_ui"
    name: "Approval Interface"
    type: "UI"
    compatible_actors:
      - "Human"
    operations:
      - "approve"
      - "reject"
      - "request_changes"

# === ACTIONS (Units of work) ===
actions:
  - id: "create_release"
    name: "Create RELEASE"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "RELEASE"
    output:
      artifact: "release_artifact"
  - id: "create_pc"
    name: "Create PC"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "PC"
    output:
      artifact: "pc_artifact"
  - id: "create_ic"
    name: "Create IC"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "IC"
    output:
      artifact: "ic_artifact"
  - id: "create_qa"
    name: "Create QA"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "QA"
    output:
      artifact: "qa_artifact"
  - id: "approve_qa"
    name: "Approve QA"
    actor: "qa_lead"
    tool: "approval_ui"
    allowed_in_states:
      - "QA"
    output:
      fact: "qa_approved"
  - id: "create_deploy"
    name: "Create DEPLOY"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "DEPLOY"
    output:
      artifact: "deploy_artifact"
  - id: "create_bc_delta"
    name: "Create BC Delta"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "BC_DELTA"
    output:
      artifact: "bc_delta_artifact"
  - id: "approve_bc_delta"
    name: "Approve BC Delta"
    actor: "product_owner"
    tool: "approval_ui"
    allowed_in_states:
      - "BC_DELTA"
    output:
      fact: "bc_delta_approved"
  - id: "create_ac_delta"
    name: "Create AC Delta"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "AC_DELTA"
    output:
      artifact: "ac_delta_artifact"
  - id: "approve_ac_delta"
    name: "Approve AC Delta"
    actor: "tech_lead"
    tool: "approval_ui"
    allowed_in_states:
      - "AC_DELTA"
    output:
      fact: "ac_delta_approved"
  - id: "create_plan_finalize"
    name: "Create PLAN FINALIZE"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "PLAN_FINALIZE"
    output:
      artifact: "plan_finalize_artifact"
  - id: "approve_plan_finalize"
    name: "Approve PLAN FINALIZE"
    actor: "team"
    tool: "approval_ui"
    allowed_in_states:
      - "PLAN_FINALIZE"
    output:
      fact: "plan_finalize_approved"
  - id: "create_apply_deltas"
    name: "Create Apply Deltas"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "APPLY_DELTAS"
    output:
      artifact: "apply_deltas_artifact"
  - id: "handle_error"
    name: "Handle Error"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "ERROR"
    output:
      fact: "error_handled"
  - id: "retry_phase"
    name: "Retry Phase"
    actor: "claude_agent"
    tool: "mcp_pcc"
    allowed_in_states:
      - "ERROR"
    output:
      fact: "phase_retried"

# === ARTIFACTS (Files/documents created) ===
artifacts:
  - id: "release_artifact"
    name: "RELEASE.md"
    type: "markdown"
    template: "templates/phases/RELEASE_TEMPLATE.md"
    created_by: "create_release"
  - id: "pc_artifact"
    name: "PC_CONTEXT.md"
    type: "markdown"
    template: "templates/phases/PC_CONTEXT_TEMPLATE.md"
    created_by: "create_pc"
  - id: "ic_artifact"
    name: "IC.md"
    type: "markdown"
    template: "templates/phases/IC_TEMPLATE.md"
    created_by: "create_ic"
  - id: "qa_artifact"
    name: "QA_TESTING.md"
    type: "markdown"
    template: "templates/phases/QA_TESTING_TEMPLATE.md"
    created_by: "create_qa"
  - id: "bc_delta_artifact"
    name: "BC_DELTA.md"
    type: "markdown"
    template: "templates/phases/BC_DELTA_TEMPLATE.md"
    created_by: "create_bc_delta"
  - id: "ac_delta_artifact"
    name: "AC_DELTA.md"
    type: "markdown"
    template: "templates/phases/AC_DELTA_TEMPLATE.md"
    created_by: "create_ac_delta"
  - id: "plan_finalize_artifact"
    name: "PLAN_FINALIZE.md"
    type: "markdown"
    template: "templates/phases/PLAN_FINALIZE_TEMPLATE.md"
    created_by: "create_plan_finalize"

# === FACTS (Events triggering transitions) ===
facts:
  # === Transitions for bugfix_simple process: RELEASE → PC → IC → QA → DEPLOY ===
  - id: "release_to_pc"
    name: "Release to PC (bugfix path)"
    from_state: "RELEASE"
    to_state: "PC"
    triggered_by: "create_release"
  - id: "pc_completed"
    name: "PC Completed"
    from_state: "PC"
    to_state: "IC"
    triggered_by: "create_pc"
  - id: "ic_completed"
    name: "IC Completed"
    from_state: "IC"
    to_state: "QA"
    triggered_by: "create_ic"
  - id: "qa_completed"
    name: "QA Completed"
    from_state: "QA"
    to_state: "DEPLOY"
    triggered_by: "create_qa"

  # === Transitions for feature_full process: RELEASE → BC_DELTA → AC_DELTA → ... ===
  - id: "release_to_bc"
    name: "Release to BC Delta (feature path)"
    from_state: "RELEASE"
    to_state: "BC_DELTA"
    triggered_by: "create_release"
  - id: "bc_delta_completed"
    name: "BC Delta Completed"
    from_state: "BC_DELTA"
    to_state: "AC_DELTA"
    triggered_by: "create_bc_delta"
  - id: "ac_delta_completed"
    name: "AC Delta Completed"
    from_state: "AC_DELTA"
    to_state: "PLAN_FINALIZE"
    triggered_by: "create_ac_delta"
  - id: "plan_finalize_completed"
    name: "Plan Finalize Completed"
    from_state: "PLAN_FINALIZE"
    to_state: "PC"
    triggered_by: "create_plan_finalize"
  - id: "qa_to_apply_deltas"
    name: "QA to Apply Deltas (feature path)"
    from_state: "QA"
    to_state: "APPLY_DELTAS"
    triggered_by: "create_qa"
  - id: "apply_deltas_completed"
    name: "Apply Deltas Completed"
    from_state: "APPLY_DELTAS"
    to_state: "DEPLOY"
    triggered_by: "create_apply_deltas"

  # === Approval facts (requires artifact creation first) ===
  - id: "qa_approved"
    name: "QA Approved"
    from_state: "QA"
    to_state: "DEPLOY"
    triggered_by: "approve_qa"
    requires:
      - "qa_completed"
  - id: "bc_delta_approved"
    name: "BC Delta Approved"
    from_state: "BC_DELTA"
    to_state: "AC_DELTA"
    triggered_by: "approve_bc_delta"
    requires:
      - "bc_delta_completed"
  - id: "ac_delta_approved"
    name: "AC Delta Approved"
    from_state: "AC_DELTA"
    to_state: "PLAN_FINALIZE"
    triggered_by: "approve_ac_delta"
    requires:
      - "ac_delta_completed"
  - id: "plan_finalize_approved"
    name: "Plan Finalize Approved"
    from_state: "PLAN_FINALIZE"
    to_state: "PC"
    triggered_by: "approve_plan_finalize"
    requires:
      - "plan_finalize_completed"

  # === Error handling facts ===
  # Error can occur from any Working/Waiting state
  - id: "error_from_pc"
    name: "Error from PC"
    from_state: "PC"
    to_state: "ERROR"
    triggered_by: "handle_error"
  - id: "error_from_ic"
    name: "Error from IC"
    from_state: "IC"
    to_state: "ERROR"
    triggered_by: "handle_error"
  - id: "error_from_qa"
    name: "Error from QA"
    from_state: "QA"
    to_state: "ERROR"
    triggered_by: "handle_error"
  - id: "error_from_bc_delta"
    name: "Error from BC Delta"
    from_state: "BC_DELTA"
    to_state: "ERROR"
    triggered_by: "handle_error"
  - id: "error_from_ac_delta"
    name: "Error from AC Delta"
    from_state: "AC_DELTA"
    to_state: "ERROR"
    triggered_by: "handle_error"
  - id: "error_from_plan_finalize"
    name: "Error from Plan Finalize"
    from_state: "PLAN_FINALIZE"
    to_state: "ERROR"
    triggered_by: "handle_error"
  - id: "error_from_apply_deltas"
    name: "Error from Apply Deltas"
    from_state: "APPLY_DELTAS"
    to_state: "ERROR"
    triggered_by: "handle_error"
  # Recovery from error - retry returns to PC (can be customized per error)
  - id: "retry_to_pc"
    name: "Retry to PC"
    from_state: "ERROR"
    to_state: "PC"
    triggered_by: "retry_phase"

# === RULES (Constraints and conditions) ===
rules:
  - id: "release_state_valid_schema"
    name: "Release State Valid Schema"
    type: "Invariant"
    condition: "validator(\"release_state_valid_schema\") == true"
    scope: "state(RELEASE)"
    on_violation: "Block"
  - id: "release_has_problem"
    name: "Release Has Problem"
    type: "Precondition"
    condition: "validator(\"release_has_problem\") == true"
    scope: "state(RELEASE)"
    on_violation: "Block"
  - id: "pc_has_implementation"
    name: "Pc Has Implementation"
    type: "Precondition"
    condition: "validator(\"pc_has_implementation\") == true"
    scope: "state(PC)"
    on_violation: "Block"
  - id: "pc_has_5_ics"
    name: "Pc Has 5 Ics"
    type: "Precondition"
    condition: "validator(\"pc_has_5_ics\") == true"
    scope: "state(PC)"
    on_violation: "Block"
  - id: "all_ics_validated"
    name: "All Ics Validated"
    type: "Postcondition"
    condition: "validator(\"all_ics_validated\") == true"
    scope: "state(IC)"
    on_violation: "Block"
  - id: "qa_tests_passed"
    name: "Qa Tests Passed"
    type: "Postcondition"
    condition: "validator(\"qa_tests_passed\") == true"
    scope: "state(QA)"
    on_violation: "Block"
  - id: "release_has_scope"
    name: "Release Has Scope"
    type: "Precondition"
    condition: "validator(\"release_has_scope\") == true"
    scope: "state(RELEASE)"
    on_violation: "Block"
  - id: "bc_has_goals"
    name: "Bc Has Goals"
    type: "Precondition"
    condition: "validator(\"bc_has_goals\") == true"
    scope: "state(BC_DELTA)"
    on_violation: "Block"
  - id: "bc_has_actors"
    name: "Bc Has Actors"
    type: "Precondition"
    condition: "validator(\"bc_has_actors\") == true"
    scope: "state(BC_DELTA)"
    on_violation: "Block"
  - id: "bc_has_scenarios"
    name: "Bc Has Scenarios"
    type: "Precondition"
    condition: "validator(\"bc_has_scenarios\") == true"
    scope: "state(BC_DELTA)"
    on_violation: "Block"
  - id: "ac_has_use_cases"
    name: "Ac Has Use Cases"
    type: "Precondition"
    condition: "validator(\"ac_has_use_cases\") == true"
    scope: "state(AC_DELTA)"
    on_violation: "Block"
  - id: "ac_based_on_bc"
    name: "Ac Based On Bc"
    type: "Precondition"
    condition: "validator(\"ac_based_on_bc\") == true"
    scope: "state(AC_DELTA)"
    on_violation: "Block"
  - id: "plan_has_tasks"
    name: "Plan Has Tasks"
    type: "Precondition"
    condition: "validator(\"plan_has_tasks\") == true"
    scope: "state(PLAN_FINALIZE)"
    on_violation: "Block"
  - id: "tasks_estimated"
    name: "Tasks Estimated"
    type: "Precondition"
    condition: "validator(\"tasks_estimated\") == true"
    scope: "state(PLAN_FINALIZE)"
    on_violation: "Block"
  - id: "no_p0_violations"
    name: "No P0 Violations"
    type: "Invariant"
    condition: "validator(\"no_p0_violations\") == true"
    scope: "state(IC)"
    on_violation: "Block"
  - id: "qa_coverage_met"
    name: "Qa Coverage Met"
    type: "Constraint"
    condition: "validator(\"qa_coverage_met\") == true"
    scope: "state(QA)"
    on_violation: "Block"

# === PROCESSES (Predefined State compositions) ===
processes:
  - id: "bugfix_simple"
    description: "Simplified process for bug fixes. Skips BC/AC analysis, goes straight to implementation: PC → IC → QA →
      DEPLOY. Use for straightforward bug fixes that don't require business context analysis."
    states_sequence:
      - "RELEASE"
      - "PC"
      - "IC"
      - "QA"
      - "DEPLOY"
    approval_points:
      - "QA"
    skip_allowed: []
  - id: "feature_full"
    description: "Full feature development process with all phases. Use for new features with business context,
      architecture, and full validation. Includes BC/AC analysis, planning, implementation, infrastructure validation,
      QA testing, and deployment."
    states_sequence:
      - "RELEASE"
      - "BC_DELTA"
      - "AC_DELTA"
      - "PLAN_FINALIZE"
      - "PC"
      - "IC"
      - "QA"
      - "APPLY_DELTAS"
      - "DEPLOY"
    approval_points:
      - "BC_DELTA"
      - "AC_DELTA"
      - "PLAN_FINALIZE"
      - "QA"
    skip_allowed: []
  - id: "feature_full_auto"
    description: "Full feature development process with NO human approvals. All phases execute automatically. Use ONLY when
      human has pre-approved the entire feature scope and trusts LLM to make all decisions."
    states_sequence:
      - "RELEASE"
      - "BC_DELTA"
      - "AC_DELTA"
      - "PLAN_FINALIZE"
      - "PC"
      - "IC"
      - "QA"
      - "APPLY_DELTAS"
      - "DEPLOY"
    approval_points: []
    skip_allowed: []
