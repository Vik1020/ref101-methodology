---
context_id: GUIDE_code_review
version: "1.2.0"
last_updated: 2026-01-04
status: active
owner: Quality Team
audience: developers
language: ru
---

# Чеклист Code Review

> Стандартизированный чеклист для ревью изменений в проектах Context Studio, обеспечивающий соответствие принципам Vibe Coding, требованиям безопасности и архитектурной целостности.

---

## Содержание

- [Перед ревью](#перед-ревью)
- [Соответствие контекстам](#соответствие-контекстам)
- [Безопасность](#безопасность-critical)
- [Доступность](#доступность-ic_a11y_standards)
- [Производительность](#производительность-ic_performance_budgets)
- [Архитектура](#архитектура-и-зависимости)
- [Качество кода](#качество-кода)
- [Тестирование](#тестирование)
- [Документация](#документация)
- [Версионирование](#версионирование-и-миграция)
- [UI/UX](#uiux)
- [Готовность к деплою](#готовность-к-деплою)

---

## Перед ревью

Перед отправкой на ревью:

- [ ] Все тесты проходят локально
- [ ] Нет ошибок и предупреждений в консоли
- [ ] Код отформатирован через Prettier/ESLint
- [ ] Commit message соответствует конвенции
- [ ] Ветка актуализирована относительно main

---

## Соответствие контекстам

### Business Context (BC)
- [ ] Изменения соответствуют целям BC
- [ ] Новые функции имеют соответствующие BC сценарии
- [ ] Версия BC указана в описании commit/PR

### Analytical Context (AC)
- [ ] PC изменения следуют AC use cases
- [ ] API контракты соответствуют AC спецификациям
- [ ] Новые use cases задокументированы в AC при необходимости

### Programmatic Context (PC)
- [ ] Изменения компонентов задокументированы в context.md
- [ ] Поле `version` обновлено при breaking change
- [ ] Поле `last_updated` актуально
- [ ] Метрики `health` обновлены

### Infrastructure Context (IC)
- [ ] Все применимые IC требования соблюдены
- [ ] Поле `compliance` содержит все IC контексты
- [ ] Нет нарушений обязательных IC правил

### Cross-Cutting Context (CCC)
- [ ] Интеграции с CCC протестированы
- [ ] Нет прямого доступа к инфраструктуре в обход CCC

---

## Безопасность (CRITICAL)

> **Полные спецификации:** [infrastructure/](../infrastructure/)

### Санитизация ввода (IC_security_input_sanitization)
- [ ] ВЕСЬ пользовательский контент санитизируется перед рендерингом
- [ ] DOMPurify используется для HTML санитизации
- [ ] НЕТ `dangerouslySetInnerHTML` без явной санитизации
- [ ] Формы валидируются и на клиенте, и на сервере

### API коммуникация (IC_security_api_communication)
- [ ] API вызовы используют HTTPS в production
- [ ] НЕТ захардкоженных API ключей или секретов
- [ ] Переменные окружения используются для чувствительных данных
- [ ] НЕТ чувствительных данных в console.log или сообщениях об ошибках

### Аутентификация и авторизация
- [ ] Защищённые маршруты требуют аутентификации
- [ ] Права пользователя проверяются перед действиями
- [ ] Токены хранятся безопасно (httpOnly cookies предпочтительнее localStorage)

### XSS предотвращение
- [ ] Пользовательский ввод экранируется во всех контекстах
- [ ] CSP заголовки настроены (если применимо)
- [ ] Trusted Types API используется где возможно

### CSRF защита
- [ ] Операции, изменяющие состояние, защищены
- [ ] CSRF токены используются для мутаций
- [ ] SameSite атрибуты cookies установлены

### Безопасность зависимостей
- [ ] `npm audit` запущен без high/critical issues
- [ ] Зависимости актуальны
- [ ] НЕТ известных уязвимостей в зависимостях

---

## Доступность (IC_a11y_standards)

### ARIA и семантика
- [ ] Все интерактивные элементы имеют ARIA labels
- [ ] Семантический HTML используется где уместно
- [ ] Атрибуты `role` корректны

### Клавиатурная навигация
- [ ] Все функции доступны с клавиатуры
- [ ] Порядок фокуса логичен
- [ ] Видимые индикаторы фокуса

### Совместимость со скринридерами
- [ ] `aria-live` регионы для динамического контента
- [ ] `alt` тексты изображений описательны
- [ ] Формы имеют правильные labels

### Цветовой контраст
- [ ] Контрастность текста ≥ 4.5:1
- [ ] Интерактивные элементы соответствуют требованиям контраста
- [ ] Цвет не единственный индикатор состояния

---

## Производительность (IC_performance_budgets)

### Размер бандла
- [ ] Бандл компонента < 50 KB gzipped (целевой показатель PC)
- [ ] Code splitting используется где уместно
- [ ] Lazy loading для некритичных компонентов

### Производительность рендеринга
- [ ] Нет лишних ре-рендеров
- [ ] `useMemo` / `useCallback` для дорогих вычислений
- [ ] Виртуальный скроллинг для длинных списков (если применимо)

### Сетевые запросы
- [ ] API вызовы оптимизированы (batching, кэширование)
- [ ] Изображения оптимизированы и lazy loaded
- [ ] Нет паттернов N+1 запросов

---

## Архитектура и зависимости

### Бюджет зависимостей
- [ ] Компонент не превышает 5 внутренних импортов
- [ ] НЕТ запрещённых cross-context зависимостей
- [ ] Секция `dependencies` в context.md обновлена
- [ ] НЕТ циклических зависимостей

### Изоляция контекстов
- [ ] Компонент не утекает абстракции
- [ ] Дублирование предпочтительнее тесной связанности
- [ ] НЕТ прямого доступа к внутренностям других контекстов

### Разделение слоёв
- [ ] UI компоненты (`src/components/ui`) остаются "глупыми"
- [ ] Бизнес-логика в хуках (`src/hooks`)
- [ ] API вызовы в сервисах (`src/services`)

---

## Качество кода

### Нейминг и конвенции
- [ ] Переменные/функции следуют проектным конвенциям нейминга
- [ ] Термины соответствуют `src/types.ts` или реестру терминов
- [ ] НЕТ придуманной терминологии без документации

### TypeScript
- [ ] НЕТ типов `any` (используйте `unknown` при необходимости)
- [ ] Интерфейсы/типы задокументированы
- [ ] Generic типы используются уместно

### React Best Practices
- [ ] Только функциональные компоненты
- [ ] Правила хуков соблюдаются (нет условных хуков)
- [ ] Props деструктурированы и типизированы
- [ ] Key props на списках уникальны и стабильны

---

## Тестирование

### Unit тесты (PC/CCC)
- [ ] Покрытие тестами ≥ 80%
- [ ] Критические пути протестированы
- [ ] Edge cases покрыты (loading, error, empty states)

### Integration тесты
- [ ] Пользовательские flow протестированы end-to-end (если применимо)
- [ ] API моки реалистичны
- [ ] Сценарии ошибок протестированы

### Self-Testing верификация (CSP)
- [ ] **Тесты выполнены** (`npm test` прошёл)
- [ ] **Покрытие проверено** (≥ 80% для PC/CCC)
- [ ] **TypeScript чистый** (`npm run type-check` прошёл)
- [ ] **Lint чистый** (`npm run lint` прошёл)
- [ ] **Build успешен** (`npm run build` прошёл)
- [ ] **AC traceability** — каждый тест связан с AC Use Case
- [ ] **Self-Testing Report** включён в PR description (для новых функций)

> **Примечание:** Для новых функций или bug fixes Claude ДОЛЖЕН следовать [CSP workflow](TESTING_STRATEGY.md#8-claude-self-testing-protocol) и генерировать Self-Testing Report.

---

## Документация

### Документация контекстов
- [ ] `context.md` обновлён (если изменился PC/IC/CCC)
- [ ] `README.md` обновлён (если изменился public API)
- [ ] Inline комментарии для сложной логики

### Health метрики
- [ ] `documentation_coverage` ≥ 90%
- [ ] `test_coverage` ≥ 80% (для PC/CCC)
- [ ] `dependency_health` green
- [ ] `staleness_days` < 90

---

## Версионирование и миграция

### SemVer соответствие
- [ ] MAJOR bump для breaking changes
- [ ] MINOR bump для новых функций (backward compatible)
- [ ] PATCH bump для bug fixes

### Breaking Changes
- [ ] Migration guide написан (если MAJOR версия)
- [ ] Затронутые контексты идентифицированы
- [ ] Rollback план задокументирован
- [ ] Deprecation warnings добавлены (если поэтапное удаление)

### Синхронизация версий контекстов
- [ ] Версии BC → AC → PC выровнены
- [ ] Ссылки `based_on` обновлены

---

## UI/UX

### Использование UI Kit
- [ ] НЕТ сырых HTML тегов `<button>` / `<input>`
- [ ] Компоненты UI Kit используются (`Button`, `Input`, и т.д.)
- [ ] Tailwind классы используются (нет inline styles)

### Responsive дизайн
- [ ] Мобильные breakpoints протестированы
- [ ] Touch targets ≥ 44px
- [ ] Горизонтальный скроллинг избегается

### Обработка ошибок
- [ ] Пользовательские сообщения об ошибках понятны
- [ ] Error boundary перехватывает сбои
- [ ] Retry логика для transient failures

---

## Структура документации

### Размер и организация файлов
- [ ] Файлы контекстов ≤ 400 строк (порог предупреждения)
- [ ] НЕТ файлов > 600 строк (рассмотреть multi-file структуру)
- [ ] Multi-file контексты имеют `_index.md` со стабильным context_id
- [ ] Связанная документация сгруппирована в логические директории

### Управление доменами
- [ ] Имя домена существует в DOMAIN_REGISTRY.md (или PR включает добавление)
- [ ] НЕТ семантического пересечения с существующими доменами (> 50% сходства)
- [ ] Домен следует правилам нейминга (lowercase, без аббревиатур, подходящая гранулярность)
- [ ] Проектный префикс (`yandex_kb_`, и т.д.) ТОЛЬКО на BC контекстах
- [ ] Домен покрывает функциональную область, НЕ отдельную функцию

### Дублирование контента
- [ ] context.md файлы ≤ 100 строк (только quick reference)
- [ ] Дублирование с PC_*.md < 30% (запустить `check-duplication`)
- [ ] Локальный context.md использует ссылки на формальный PC_*.md для деталей
- [ ] Единый источник истины установлен (обычно PC_*.md)

### Граф зависимостей
- [ ] `npm run context-graph -- --check` проходит
- [ ] НЕТ битых ссылок в полях `based_on`
- [ ] НЕТ циклических зависимостей
- [ ] Несоответствия версий разрешены (указанная версия = актуальная версия)
- [ ] НЕТ orphaned контекстов (если не намеренно)

### Валидация
- [ ] `npm run validate-context` проходит для всех изменённых контекстов
- [ ] `npm run collect-metrics` показывает healthy статус (≥ 80 score)
- [ ] Предупреждения о размере файлов устранены
- [ ] Валидация доменов проходит

---

## Готовность к деплою

### Конфигурация окружения
- [ ] `.env.example` обновлён с новыми переменными
- [ ] НЕТ environment-specific логики в коде
- [ ] Feature flags используются для экспериментальных функций (если применимо)

### Процесс сборки
- [ ] `npm run build` успешен
- [ ] НЕТ build warnings
- [ ] Lighthouse score ≥ 90 (performance, a11y)

### Мониторинг и логирование
- [ ] Ошибки логируются в сервис мониторинга (Sentry, и т.д.)
- [ ] Метрики производительности отслеживаются
- [ ] Analytics events добавлены (если новая функция)

---

## Финальное одобрение

**Sign-Off ревьюера:**
- [ ] Все пункты чеклиста проверены
- [ ] Код проверен на логические ошибки
- [ ] Архитектурное ревью завершено
- [ ] Security ревью завершено

**Заметки для следующего ревью:**
- {Любые замечания или follow-up пункты}

---

## Связанные документы

| Документ | Описание |
|----------|----------|
| [SECURITY_GUIDELINES](../reference/non-functional/SECURITY_GUIDELINES.md) | Полные рекомендации по безопасности |
| [CONTEXT_HEALTH_METRICS](./CONTEXT_HEALTH_METRICS.md) | Метрики здоровья контекстов |
| [MIGRATION_STRATEGY](./MIGRATION_STRATEGY.md) | Стратегия миграции |
| [DEPENDENCY_RULES](../architecture/03_DEPENDENCY_RULES.md) | Правила зависимостей |
| [TESTING_STRATEGY](./TESTING_STRATEGY.md) | Стратегия тестирования и CSP |

---

**Последнее обновление:** 2026-01-04
**Владелец:** Quality Team
**Статус:** Active
